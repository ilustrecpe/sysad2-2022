---

- hosts: all
  become: true
  tasks:
    - name: Install Nagios Core
      apt:
        pkg:
          - wget
          - unzip
          - curl
          - openssl
          - build-essential
          - libgd-dev
          - libapache2-mod-php
          - php-gd
          - php
          - apache2
        update_cache: yes


        # - name: Download nagios core setup
      # ansible.builtin.command: wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.6.tar.gz

    - name: extract
      ansible.builtin.command: sudo tar -zxvf nagios-4.4.6.tar.gz

    - name: directory
      ansible.builtin.command: "sudo ./configure"
      args:
        chdir: "nagios-4.4.6"

    - name: installation
      ansible.builtin.command: "sudo make all"
      args:
        chdir: "nagios-4.4.6"
    
    - name: group and user
      ansible.builtin.command: "sudo make install-groups-users"
      args:
        chdir: "nagios-4.4.6"

    - name: usermod
      ansible.builtin.command: "sudo usermod -a -G nagios www-data"
      args:
        chdir: "nagios-4.4.6"

    - name: install
      ansible.builtin.command: "sudo make install"
      args:
        chdir: "nagios-4.4.6"

    - name: init
      ansible.builtin.command: "sudo make install-init"
      args:
        chdir: "nagios-4.4.6"
    
    - name: config dir
      ansible.builtin.command: "sudo make install-commandmode"
      args:
        chdir: "nagios-4.4.6"

    - name: cfg files
      ansible.builtin.command: "sudo make install-config"
      args:
        chdir: "nagios-4.4.6"

        #    - name: apache files
        # ansible.builtin.command: "sudo make install-webconf"
        # args:
        # chdir: "nagios-4.4.6"

    - name: rewrite mode
      ansible.builtin.command: "sudo a2enmod rewrite"
      args:
        chdir: "nagios-4.4.6"

    - name: CGI cfg
      ansible.builtin.command: "sudo a2enmod cgi"
      args:
        chdir: "nagios-4.4.6"

    - name: enable cgi
      ansible.builtin.command: sudo systemctl restart apache2
    

    - name: Nagios plugins
      ansible.builtin.command: wget https://nagios-plugins.org/download/nagios-plugins-2.3.3.tar.gz

    - name: extract plugin
      ansible.builtin.command: sudo tar -zxvf nagios-plugins-2.3.3.tar.gz

    - name: directory
      ansible.builtin.command: "sudo ./configure --with-nagios-user=nagios --with-nagios-group=nagios"
      args:
        chdir: "nagios-plugins-2.3.3/"

    - name: cfg script
      ansible.builtin.command: "sudo make"
      args:
        chdir: "nagios-plugins-2.3.3/"

    - name: install plugins
      ansible.builtin.command: "sudo make install"
      args:
        chdir: "nagios-plugins-2.3.3/"



